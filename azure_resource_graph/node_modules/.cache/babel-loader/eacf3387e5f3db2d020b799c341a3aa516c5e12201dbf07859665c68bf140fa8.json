{"ast":null,"code":"import { NodeProgram } from 'sigma/rendering';\nimport { floatColor } from 'sigma/utils';\nimport { EventEmitter } from 'events';\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n  return t;\n}\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = _superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nfunction _superPropGet(t, o, e, r) {\n  var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e);\n  return 2 & r && \"function\" == typeof p ? function (t) {\n    return p.apply(e, t);\n  } : p;\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nfunction _objectWithoutPropertiesLoose(r, e) {\n  if (null == r) return {};\n  var t = {};\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\n    if (e.includes(n)) continue;\n    t[n] = r[n];\n  }\n  return t;\n}\nfunction _objectWithoutProperties(e, t) {\n  if (null == e) return {};\n  var o,\n    r,\n    i = _objectWithoutPropertiesLoose(e, t);\n  if (Object.getOwnPropertySymbols) {\n    var s = Object.getOwnPropertySymbols(e);\n    for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\n  }\n  return i;\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction getFragmentShader(_ref) {\n  var texturesCount = _ref.texturesCount;\n  // language=GLSL\n  var SHADER = /*glsl*/\"\\nprecision highp float;\\n\\nvarying vec4 v_color;\\nvarying vec2 v_diffVector;\\nvarying float v_radius;\\nvarying vec4 v_texture;\\nvarying float v_textureIndex;\\n\\nuniform sampler2D u_atlas[\".concat(texturesCount, \"];\\nuniform float u_correctionRatio;\\nuniform float u_cameraAngle;\\nuniform float u_percentagePadding;\\nuniform bool u_colorizeImages;\\nuniform bool u_keepWithinCircle;\\n\\nconst vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);\\n\\nconst float radius = 0.5;\\n\\nvoid main(void) {\\n  float border = 2.0 * u_correctionRatio;\\n  float dist = length(v_diffVector);\\n  vec4 color = gl_FragColor;\\n\\n  float c = cos(-u_cameraAngle);\\n  float s = sin(-u_cameraAngle);\\n  vec2 diffVector = mat2(c, s, -s, c) * (v_diffVector);\\n\\n  // No antialiasing for picking mode:\\n  #ifdef PICKING_MODE\\n  border = 0.0;\\n  color = v_color;\\n\\n  #else\\n  // First case: No image to display\\n  if (v_texture.w <= 0.0) {\\n    if (!u_colorizeImages) {\\n      color = v_color;\\n    }\\n  }\\n\\n  // Second case: Image loaded into the texture\\n  else {\\n    float paddingRatio = 1.0 + 2.0 * u_percentagePadding;\\n    float coef = u_keepWithinCircle ? 1.0 : \").concat(Math.SQRT2, \";\\n    vec2 coordinateInTexture = diffVector * vec2(paddingRatio, -paddingRatio) / v_radius / 2.0 * coef + vec2(0.5, 0.5);\\n    int index = int(v_textureIndex + 0.5); // +0.5 avoid rounding errors\\n\\n    bool noTextureFound = false;\\n    vec4 texel;\\n\\n    \").concat(_toConsumableArray(new Array(texturesCount)).map(function (_, i) {\n    return \"if (index == \".concat(i, \") texel = texture2D(u_atlas[\").concat(i, \"], (v_texture.xy + coordinateInTexture * v_texture.zw), -1.0);\");\n  }).join(\"\\n    else \") + \"else {\\n      texel = texture2D(u_atlas[0], (v_texture.xy + coordinateInTexture * v_texture.zw), -1.0);\\n      noTextureFound = true;\\n    }\", \"\\n\\n    if (noTextureFound) {\\n      color = v_color;\\n    } else {\\n      // Colorize all visible image pixels:\\n      if (u_colorizeImages) {\\n        color = mix(gl_FragColor, v_color, texel.a);\\n      }\\n\\n      // Colorize background pixels, keep image pixel colors:\\n      else {\\n        color = vec4(mix(v_color, texel, texel.a).rgb, max(texel.a, v_color.a));\\n      }\\n\\n      // Erase pixels \\\"in the padding\\\":\\n      if (abs(diffVector.x) > v_radius / paddingRatio || abs(diffVector.y) > v_radius / paddingRatio) {\\n        color = u_colorizeImages ? gl_FragColor : v_color;\\n      }\\n    }\\n  }\\n  #endif\\n\\n  // Crop in a circle when u_keepWithinCircle is truthy:\\n  if (u_keepWithinCircle) {\\n    if (dist < v_radius - border) {\\n      gl_FragColor = color;\\n    } else if (dist < v_radius) {\\n      gl_FragColor = mix(transparent, color, (v_radius - dist) / border);\\n    }\\n  }\\n\\n  // Crop in a square else:\\n  else {\\n    float squareHalfSize = v_radius * \").concat(Math.SQRT1_2 * Math.cos(Math.PI / 12), \";\\n    if (abs(diffVector.x) > squareHalfSize || abs(diffVector.y) > squareHalfSize) {\\n      gl_FragColor = transparent;\\n    } else {\\n      gl_FragColor = color;\\n    }\\n  }\\n}\\n\");\n  return SHADER;\n}\n\n// language=GLSL\nvar VERTEX_SHADER_SOURCE = /*glsl*/\"\\nattribute vec4 a_id;\\nattribute vec4 a_color;\\nattribute vec2 a_position;\\nattribute float a_size;\\nattribute float a_angle;\\nattribute vec4 a_texture;\\nattribute float a_textureIndex;\\n\\nuniform mat3 u_matrix;\\nuniform float u_sizeRatio;\\nuniform float u_correctionRatio;\\n\\nvarying vec4 v_color;\\nvarying vec2 v_diffVector;\\nvarying float v_radius;\\nvarying vec4 v_texture;\\nvarying float v_textureIndex;\\n\\nconst float bias = 255.0 / 254.0;\\nconst float marginRatio = 1.05;\\n\\nvoid main() {\\n  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;\\n  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));\\n  vec2 position = a_position + diffVector * marginRatio;\\n  gl_Position = vec4(\\n    (u_matrix * vec3(position, 1)).xy,\\n    0,\\n    1\\n  );\\n\\n  v_diffVector = diffVector;\\n  v_radius = size / 2.0 / marginRatio;\\n\\n  #ifdef PICKING_MODE\\n  // For picking mode, we use the ID as the color:\\n  v_color = a_id;\\n  #else\\n  // For normal mode, we use the color:\\n  v_color = a_color;\\n\\n  // Pass the texture coordinates:\\n  v_textureIndex = a_textureIndex;\\n  v_texture = a_texture;\\n  #endif\\n\\n  v_color.a *= bias;\\n}\\n\";\nvar VERTEX_SHADER_SOURCE$1 = VERTEX_SHADER_SOURCE;\nfunction _regeneratorRuntime() {\n  _regeneratorRuntime = function () {\n    return e;\n  };\n  var t,\n    e = {},\n    r = Object.prototype,\n    n = r.hasOwnProperty,\n    o = Object.defineProperty || function (t, e, r) {\n      t[e] = r.value;\n    },\n    i = \"function\" == typeof Symbol ? Symbol : {},\n    a = i.iterator || \"@@iterator\",\n    c = i.asyncIterator || \"@@asyncIterator\",\n    u = i.toStringTag || \"@@toStringTag\";\n  function define(t, e, r) {\n    return Object.defineProperty(t, e, {\n      value: r,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), t[e];\n  }\n  try {\n    define({}, \"\");\n  } catch (t) {\n    define = function (t, e, r) {\n      return t[e] = r;\n    };\n  }\n  function wrap(t, e, r, n) {\n    var i = e && e.prototype instanceof Generator ? e : Generator,\n      a = Object.create(i.prototype),\n      c = new Context(n || []);\n    return o(a, \"_invoke\", {\n      value: makeInvokeMethod(t, r, c)\n    }), a;\n  }\n  function tryCatch(t, e, r) {\n    try {\n      return {\n        type: \"normal\",\n        arg: t.call(e, r)\n      };\n    } catch (t) {\n      return {\n        type: \"throw\",\n        arg: t\n      };\n    }\n  }\n  e.wrap = wrap;\n  var h = \"suspendedStart\",\n    l = \"suspendedYield\",\n    f = \"executing\",\n    s = \"completed\",\n    y = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  var p = {};\n  define(p, a, function () {\n    return this;\n  });\n  var d = Object.getPrototypeOf,\n    v = d && d(d(values([])));\n  v && v !== r && n.call(v, a) && (p = v);\n  var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);\n  function defineIteratorMethods(t) {\n    [\"next\", \"throw\", \"return\"].forEach(function (e) {\n      define(t, e, function (t) {\n        return this._invoke(e, t);\n      });\n    });\n  }\n  function AsyncIterator(t, e) {\n    function invoke(r, o, i, a) {\n      var c = tryCatch(t[r], t, o);\n      if (\"throw\" !== c.type) {\n        var u = c.arg,\n          h = u.value;\n        return h && \"object\" == typeof h && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) {\n          invoke(\"next\", t, i, a);\n        }, function (t) {\n          invoke(\"throw\", t, i, a);\n        }) : e.resolve(h).then(function (t) {\n          u.value = t, i(u);\n        }, function (t) {\n          return invoke(\"throw\", t, i, a);\n        });\n      }\n      a(c.arg);\n    }\n    var r;\n    o(this, \"_invoke\", {\n      value: function (t, n) {\n        function callInvokeWithMethodAndArg() {\n          return new e(function (e, r) {\n            invoke(t, n, e, r);\n          });\n        }\n        return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      }\n    });\n  }\n  function makeInvokeMethod(e, r, n) {\n    var o = h;\n    return function (i, a) {\n      if (o === f) throw Error(\"Generator is already running\");\n      if (o === s) {\n        if (\"throw\" === i) throw a;\n        return {\n          value: t,\n          done: !0\n        };\n      }\n      for (n.method = i, n.arg = a;;) {\n        var c = n.delegate;\n        if (c) {\n          var u = maybeInvokeDelegate(c, n);\n          if (u) {\n            if (u === y) continue;\n            return u;\n          }\n        }\n        if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) {\n          if (o === h) throw o = s, n.arg;\n          n.dispatchException(n.arg);\n        } else \"return\" === n.method && n.abrupt(\"return\", n.arg);\n        o = f;\n        var p = tryCatch(e, r, n);\n        if (\"normal\" === p.type) {\n          if (o = n.done ? s : l, p.arg === y) continue;\n          return {\n            value: p.arg,\n            done: n.done\n          };\n        }\n        \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg);\n      }\n    };\n  }\n  function maybeInvokeDelegate(e, r) {\n    var n = r.method,\n      o = e.iterator[n];\n    if (o === t) return r.delegate = null, \"throw\" === n && e.iterator.return && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y;\n    var i = tryCatch(o, e.iterator, r.arg);\n    if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y;\n    var a = i.arg;\n    return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y);\n  }\n  function pushTryEntry(t) {\n    var e = {\n      tryLoc: t[0]\n    };\n    1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);\n  }\n  function resetTryEntry(t) {\n    var e = t.completion || {};\n    e.type = \"normal\", delete e.arg, t.completion = e;\n  }\n  function Context(t) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], t.forEach(pushTryEntry, this), this.reset(!0);\n  }\n  function values(e) {\n    if (e || \"\" === e) {\n      var r = e[a];\n      if (r) return r.call(e);\n      if (\"function\" == typeof e.next) return e;\n      if (!isNaN(e.length)) {\n        var o = -1,\n          i = function next() {\n            for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;\n            return next.value = t, next.done = !0, next;\n          };\n        return i.next = i;\n      }\n    }\n    throw new TypeError(typeof e + \" is not iterable\");\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", {\n    value: GeneratorFunctionPrototype,\n    configurable: !0\n  }), o(GeneratorFunctionPrototype, \"constructor\", {\n    value: GeneratorFunction,\n    configurable: !0\n  }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) {\n    var e = \"function\" == typeof t && t.constructor;\n    return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name));\n  }, e.mark = function (t) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t;\n  }, e.awrap = function (t) {\n    return {\n      __await: t\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {\n    return this;\n  }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {\n    void 0 === i && (i = Promise);\n    var a = new AsyncIterator(wrap(t, r, n, o), i);\n    return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {\n      return t.done ? t.value : a.next();\n    });\n  }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () {\n    return this;\n  }), define(g, \"toString\", function () {\n    return \"[object Generator]\";\n  }), e.keys = function (t) {\n    var e = Object(t),\n      r = [];\n    for (var n in e) r.push(n);\n    return r.reverse(), function next() {\n      for (; r.length;) {\n        var t = r.pop();\n        if (t in e) return next.value = t, next.done = !1, next;\n      }\n      return next.done = !0, next;\n    };\n  }, e.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function (e) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);\n    },\n    stop: function () {\n      this.done = !0;\n      var t = this.tryEntries[0].completion;\n      if (\"throw\" === t.type) throw t.arg;\n      return this.rval;\n    },\n    dispatchException: function (e) {\n      if (this.done) throw e;\n      var r = this;\n      function handle(n, o) {\n        return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o;\n      }\n      for (var o = this.tryEntries.length - 1; o >= 0; --o) {\n        var i = this.tryEntries[o],\n          a = i.completion;\n        if (\"root\" === i.tryLoc) return handle(\"end\");\n        if (i.tryLoc <= this.prev) {\n          var c = n.call(i, \"catchLoc\"),\n            u = n.call(i, \"finallyLoc\");\n          if (c && u) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          } else if (c) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n          } else {\n            if (!u) throw Error(\"try statement without catch or finally\");\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function (t, e) {\n      for (var r = this.tryEntries.length - 1; r >= 0; --r) {\n        var o = this.tryEntries[r];\n        if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) {\n          var i = o;\n          break;\n        }\n      }\n      i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);\n      var a = i ? i.completion : {};\n      return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a);\n    },\n    complete: function (t, e) {\n      if (\"throw\" === t.type) throw t.arg;\n      return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y;\n    },\n    finish: function (t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;\n      }\n    },\n    catch: function (t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.tryLoc === t) {\n          var n = r.completion;\n          if (\"throw\" === n.type) {\n            var o = n.arg;\n            resetTryEntry(r);\n          }\n          return o;\n        }\n      }\n      throw Error(\"illegal catch attempt\");\n    },\n    delegateYield: function (e, r, n) {\n      return this.delegate = {\n        iterator: values(e),\n        resultName: r,\n        nextLoc: n\n      }, \"next\" === this.method && (this.arg = t), y;\n    }\n  }, e;\n}\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\n\n/**\n * Useful types:\n * *************\n */\n\nvar DEFAULT_TEXTURE_MANAGER_OPTIONS = {\n  size: {\n    mode: \"max\",\n    value: 512\n  },\n  objectFit: \"cover\",\n  correctCentering: false,\n  maxTextureSize: 4096,\n  debounceTimeout: 500,\n  crossOrigin: \"anonymous\"\n};\n\n// This margin helps to avoid images collisions in the texture:\nvar MARGIN_IN_TEXTURE = 1;\n\n/**\n * Helpers:\n * ********\n */\n/**\n * This helper loads an image at a given URL, and returns an HTMLImageElement\n * with it displayed once it's properly loaded, within a promise.\n */\nfunction loadRasterImage(imageSource) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    crossOrigin = _ref.crossOrigin;\n  return new Promise(function (resolve, reject) {\n    var image = new Image();\n    image.addEventListener(\"load\", function () {\n      resolve(image);\n    }, {\n      once: true\n    });\n    image.addEventListener(\"error\", function (e) {\n      reject(e.error);\n    }, {\n      once: true\n    });\n\n    // Load image:\n    if (crossOrigin) {\n      image.setAttribute(\"crossOrigin\", crossOrigin);\n    }\n    image.src = imageSource;\n  });\n}\n\n/**\n * This helper loads an SVG image at a given URL, adjusts its size to a given\n * size, and returns an HTMLImageElement with it displayed once it's properly\n * loaded, within a promise.\n */\nfunction loadSVGImage(_x) {\n  return _loadSVGImage.apply(this, arguments);\n}\n\n/**\n * This helper loads an image using the proper function.\n */\nfunction _loadSVGImage() {\n  _loadSVGImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(imageSource) {\n    var _ref2,\n      size,\n      crossOrigin,\n      resp,\n      svgString,\n      svg,\n      root,\n      originalWidth,\n      originalHeight,\n      correctedSvgString,\n      blob,\n      url,\n      res,\n      _args2 = arguments;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _ref2 = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : {}, size = _ref2.size, crossOrigin = _ref2.crossOrigin;\n          if (!(crossOrigin === \"use-credentials\")) {\n            _context2.next = 7;\n            break;\n          }\n          _context2.next = 4;\n          return fetch(imageSource, {\n            credentials: \"include\"\n          });\n        case 4:\n          resp = _context2.sent;\n          _context2.next = 10;\n          break;\n        case 7:\n          _context2.next = 9;\n          return fetch(imageSource);\n        case 9:\n          resp = _context2.sent;\n        case 10:\n          _context2.next = 12;\n          return resp.text();\n        case 12:\n          svgString = _context2.sent;\n          svg = new DOMParser().parseFromString(svgString, \"image/svg+xml\");\n          root = svg.documentElement;\n          originalWidth = root.getAttribute(\"width\");\n          originalHeight = root.getAttribute(\"height\");\n          if (!(!originalWidth || !originalHeight)) {\n            _context2.next = 19;\n            break;\n          }\n          throw new Error(\"loadSVGImage: cannot use `size` if target SVG has no definite dimensions.\");\n        case 19:\n          if (typeof size === \"number\") {\n            root.setAttribute(\"width\", \"\" + size);\n            root.setAttribute(\"height\", \"\" + size);\n          }\n\n          // NOTE: since Google Material last changes to their icon viewBox, this\n          // code is no longer necessary (hopefully it does not break something else...)\n          // root.setAttribute(\"viewBox\", `0 0 ${originalWidth} ${originalHeight}`);\n          correctedSvgString = new XMLSerializer().serializeToString(svg);\n          blob = new Blob([correctedSvgString], {\n            type: \"image/svg+xml\"\n          });\n          url = URL.createObjectURL(blob);\n          res = loadRasterImage(url);\n          res[\"finally\"](function () {\n            return URL.revokeObjectURL(url);\n          });\n          return _context2.abrupt(\"return\", res);\n        case 26:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _loadSVGImage.apply(this, arguments);\n}\nfunction loadImage(_x2) {\n  return _loadImage.apply(this, arguments);\n}\n\n/**\n * This helper computes exact coordinates to draw an image onto a texture.\n */\nfunction _loadImage() {\n  _loadImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(imageSource) {\n    var _imageSource$split$0$;\n    var _ref3,\n      size,\n      crossOrigin,\n      isSVG,\n      image,\n      _args3 = arguments;\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _ref3 = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {}, size = _ref3.size, crossOrigin = _ref3.crossOrigin;\n          isSVG = ((_imageSource$split$0$ = imageSource.split(/[#?]/)[0].split(\".\").pop()) === null || _imageSource$split$0$ === void 0 ? void 0 : _imageSource$split$0$.trim().toLowerCase()) === \"svg\";\n          if (!(isSVG && size)) {\n            _context3.next = 16;\n            break;\n          }\n          _context3.prev = 3;\n          _context3.next = 6;\n          return loadSVGImage(imageSource, {\n            size: size,\n            crossOrigin: crossOrigin\n          });\n        case 6:\n          image = _context3.sent;\n          _context3.next = 14;\n          break;\n        case 9:\n          _context3.prev = 9;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 13;\n          return loadRasterImage(imageSource, {\n            crossOrigin: crossOrigin\n          });\n        case 13:\n          image = _context3.sent;\n        case 14:\n          _context3.next = 19;\n          break;\n        case 16:\n          _context3.next = 18;\n          return loadRasterImage(imageSource, {\n            crossOrigin: crossOrigin\n          });\n        case 18:\n          image = _context3.sent;\n        case 19:\n          return _context3.abrupt(\"return\", image);\n        case 20:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[3, 9]]);\n  }));\n  return _loadImage.apply(this, arguments);\n}\nfunction refineImage(image, corrector, _ref4) {\n  var objectFit = _ref4.objectFit,\n    size = _ref4.size,\n    correctCentering = _ref4.correctCentering;\n  var sourceSize = objectFit === \"contain\" ? Math.max(image.width, image.height) : Math.min(image.width, image.height);\n  var destinationSize = size.mode === \"auto\" ? sourceSize : size.mode === \"force\" ? size.value : Math.min(size.value, sourceSize);\n  var sourceX = (image.width - sourceSize) / 2;\n  var sourceY = (image.height - sourceSize) / 2;\n  if (correctCentering) {\n    var correction = corrector.getCorrectionOffset(image, sourceSize);\n    sourceX = correction.x;\n    sourceY = correction.y;\n  }\n  return {\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourceSize: sourceSize,\n    destinationSize: destinationSize\n  };\n}\n\n/**\n * This helper takes an array of ready-to-draw images, and draws as much as possible in a single texture.\n * It then returns the atlas of the draw images, as well as the texture itself.\n */\nfunction drawTexture(images, ctx, cursor) {\n  var _ctx$canvas = ctx.canvas,\n    width = _ctx$canvas.width,\n    height = _ctx$canvas.height;\n\n  // Refine images coordinates:\n  var refinedImagesArray = [];\n  var x = cursor.x,\n    y = cursor.y,\n    rowHeight = cursor.rowHeight,\n    maxRowWidth = cursor.maxRowWidth;\n  var atlas = {};\n  for (var i = 0, l = images.length; i < l; i++) {\n    var _images$i = images[i],\n      key = _images$i.key,\n      image = _images$i.image,\n      sourceSize = _images$i.sourceSize,\n      sourceX = _images$i.sourceX,\n      sourceY = _images$i.sourceY,\n      destinationSize = _images$i.destinationSize;\n    var destinationSizeWithMargin = destinationSize + MARGIN_IN_TEXTURE;\n\n    // If the image does not fit, just skip it:\n    if (y + destinationSizeWithMargin > height || x + destinationSizeWithMargin > width && y + destinationSizeWithMargin + rowHeight > height) {\n      continue;\n    }\n    if (x + destinationSizeWithMargin > width) {\n      maxRowWidth = Math.max(maxRowWidth, x);\n      x = 0;\n      y += rowHeight;\n      rowHeight = destinationSizeWithMargin;\n    }\n    refinedImagesArray.push({\n      key: key,\n      image: image,\n      sourceX: sourceX,\n      sourceY: sourceY,\n      sourceSize: sourceSize,\n      destinationX: x,\n      destinationY: y,\n      destinationSize: destinationSize\n    });\n    atlas[key] = {\n      x: x,\n      y: y,\n      size: destinationSize\n    };\n    x += destinationSizeWithMargin;\n    rowHeight = Math.max(rowHeight, destinationSizeWithMargin);\n  }\n\n  // Crop texture to final best dimensions:\n  maxRowWidth = Math.max(maxRowWidth, x);\n  var effectiveWidth = maxRowWidth;\n  var effectiveHeight = y + rowHeight;\n\n  // Fill texture:\n  for (var _i = 0, _l = refinedImagesArray.length; _i < _l; _i++) {\n    var _refinedImagesArray$_ = refinedImagesArray[_i],\n      _image = _refinedImagesArray$_.image,\n      _sourceSize = _refinedImagesArray$_.sourceSize,\n      _sourceX = _refinedImagesArray$_.sourceX,\n      _sourceY = _refinedImagesArray$_.sourceY,\n      _destinationSize = _refinedImagesArray$_.destinationSize,\n      destinationX = _refinedImagesArray$_.destinationX,\n      destinationY = _refinedImagesArray$_.destinationY;\n    ctx.drawImage(_image, _sourceX, _sourceY, _sourceSize, _sourceSize, destinationX, destinationY, _destinationSize, _destinationSize);\n  }\n  return {\n    atlas: atlas,\n    texture: ctx.getImageData(0, 0, effectiveWidth, effectiveHeight),\n    cursor: {\n      x: x,\n      y: y,\n      rowHeight: rowHeight,\n      maxRowWidth: maxRowWidth\n    }\n  };\n}\n\n/**\n * This helper takes a collection of image states and a context, draw all the\n * images in the context, and returns an atlas to get where each image is drawn\n * on the texture.\n */\nfunction drawTextures(_ref5, images, ctx) {\n  var prevAtlas = _ref5.atlas,\n    prevTextures = _ref5.textures,\n    prevCursor = _ref5.cursor;\n  var res = {\n    atlas: _objectSpread2({}, prevAtlas),\n    textures: _toConsumableArray(prevTextures.slice(0, -1)),\n    cursor: _objectSpread2({}, prevCursor)\n  };\n\n  // Extract images that are ready to draw, but not drawn yet:\n  var imagesToDraw = [];\n  for (var key in images) {\n    var _prevAtlas$key;\n    // Skip images that are not ready yet:\n    var imageState = images[key];\n    if (imageState.status !== \"ready\") continue;\n\n    // Skip all images that already exist in a texture:\n    var textureIndex = (_prevAtlas$key = prevAtlas[key]) === null || _prevAtlas$key === void 0 ? void 0 : _prevAtlas$key.textureIndex;\n    if (typeof textureIndex === \"number\") continue;\n\n    // Keep all the rest:\n    imagesToDraw.push(_objectSpread2({\n      key: key\n    }, imageState));\n  }\n\n  // Draw remaining images on new textures until there are none remaining:\n  var _loop = function _loop() {\n    var _drawTexture = drawTexture(imagesToDraw, ctx, res.cursor),\n      atlas = _drawTexture.atlas,\n      texture = _drawTexture.texture,\n      cursor = _drawTexture.cursor;\n    res.cursor = cursor;\n    var remainingImages = [];\n    imagesToDraw.forEach(function (image) {\n      if (atlas[image.key]) {\n        res.atlas[image.key] = _objectSpread2(_objectSpread2({}, atlas[image.key]), {}, {\n          textureIndex: res.textures.length\n        });\n      } else {\n        remainingImages.push(image);\n      }\n    });\n    res.textures.push(texture);\n    imagesToDraw = remainingImages;\n    if (imagesToDraw.length) {\n      res.cursor = {\n        x: 0,\n        y: 0,\n        rowHeight: 0,\n        maxRowWidth: 0\n      };\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    }\n  };\n  while (imagesToDraw.length) {\n    _loop();\n  }\n  return res;\n}\n\n/**\n * This class helps to \"correct\" the centering of an SVG pictogram by finding\n * the \"true\" visually correct center through the barycenter of the pictogram's\n * alpha layer in x and y dimension.\n */\nvar PictogramCenteringCorrector = /*#__PURE__*/function () {\n  function PictogramCenteringCorrector() {\n    _classCallCheck(this, PictogramCenteringCorrector);\n    this.canvas = document.createElement(\"canvas\");\n    this.context = this.canvas.getContext(\"2d\", {\n      willReadFrequently: true\n    });\n  }\n  _createClass(PictogramCenteringCorrector, [{\n    key: \"getCorrectionOffset\",\n    value: function getCorrectionOffset(image, size) {\n      this.canvas.width = size;\n      this.canvas.height = size;\n      this.context.clearRect(0, 0, size, size);\n      this.context.drawImage(image, 0, 0, size, size);\n      var data = this.context.getImageData(0, 0, size, size).data;\n      var alpha = new Uint8ClampedArray(data.length / 4);\n      for (var i = 0; i < data.length; i++) {\n        alpha[i] = data[i * 4 + 3];\n      }\n      var sumX = 0;\n      var sumY = 0;\n      var total = 0;\n      for (var y = 0; y < size; y++) {\n        for (var x = 0; x < size; x++) {\n          var a = alpha[y * size + x];\n          total += a;\n          sumX += a * x;\n          sumY += a * y;\n        }\n      }\n      var barycenterX = sumX / total;\n      var barycenterY = sumY / total;\n      return {\n        x: barycenterX - size / 2,\n        y: barycenterY - size / 2\n      };\n    }\n  }]);\n  return PictogramCenteringCorrector;\n}();\nvar TextureManager = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(TextureManager, _EventEmitter);\n  function TextureManager() {\n    var _this;\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, TextureManager);\n    _this = _callSuper(this, TextureManager);\n    _defineProperty(_assertThisInitialized(_this), \"canvas\", document.createElement(\"canvas\"));\n    _defineProperty(_assertThisInitialized(_this), \"ctx\", _this.canvas.getContext(\"2d\", {\n      willReadFrequently: true\n    }));\n    _defineProperty(_assertThisInitialized(_this), \"corrector\", new PictogramCenteringCorrector());\n    _defineProperty(_assertThisInitialized(_this), \"imageStates\", {});\n    _defineProperty(_assertThisInitialized(_this), \"textures\", [_this.ctx.getImageData(0, 0, 1, 1)]);\n    _defineProperty(_assertThisInitialized(_this), \"lastTextureCursor\", {\n      x: 0,\n      y: 0,\n      rowHeight: 0,\n      maxRowWidth: 0\n    });\n    _defineProperty(_assertThisInitialized(_this), \"atlas\", {});\n    _this.options = _objectSpread2(_objectSpread2({}, DEFAULT_TEXTURE_MANAGER_OPTIONS), options);\n    _this.canvas.width = _this.options.maxTextureSize;\n    _this.canvas.height = _this.options.maxTextureSize;\n    return _this;\n  }\n  _createClass(TextureManager, [{\n    key: \"scheduleGenerateTexture\",\n    value: function scheduleGenerateTexture() {\n      var _this2 = this;\n      if (typeof this.frameId === \"number\") return;\n      if (typeof this.options.debounceTimeout === \"number\") {\n        this.frameId = window.setTimeout(function () {\n          _this2.generateTextures();\n          _this2.frameId = undefined;\n        }, this.options.debounceTimeout);\n      } else {\n        this.generateTextures();\n      }\n    }\n  }, {\n    key: \"generateTextures\",\n    value: function generateTextures() {\n      var _drawTextures = drawTextures({\n          atlas: this.atlas,\n          textures: this.textures,\n          cursor: this.lastTextureCursor\n        }, this.imageStates, this.ctx),\n        atlas = _drawTextures.atlas,\n        textures = _drawTextures.textures,\n        cursor = _drawTextures.cursor;\n      this.atlas = atlas;\n      this.textures = textures;\n      this.lastTextureCursor = cursor;\n      this.emit(TextureManager.NEW_TEXTURE_EVENT, {\n        atlas: atlas,\n        textures: textures\n      });\n    }\n\n    // PUBLIC API:\n  }, {\n    key: \"registerImage\",\n    value: function () {\n      var _registerImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(source) {\n        var size, image;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.imageStates[source]) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              this.imageStates[source] = {\n                status: \"loading\"\n              };\n              _context.prev = 3;\n              size = this.options.size;\n              _context.next = 7;\n              return loadImage(source, {\n                size: size.mode === \"force\" ? size.value : undefined,\n                crossOrigin: this.options.crossOrigin || undefined\n              });\n            case 7:\n              image = _context.sent;\n              this.imageStates[source] = _objectSpread2({\n                status: \"ready\",\n                image: image\n              }, refineImage(image, this.corrector, this.options));\n              this.scheduleGenerateTexture();\n              _context.next = 15;\n              break;\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](3);\n              this.imageStates[source] = {\n                status: \"error\"\n              };\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 12]]);\n      }));\n      function registerImage(_x3) {\n        return _registerImage.apply(this, arguments);\n      }\n      return registerImage;\n    }()\n  }, {\n    key: \"getAtlas\",\n    value: function getAtlas() {\n      return this.atlas;\n    }\n  }, {\n    key: \"getTextures\",\n    value: function getTextures() {\n      return this.textures;\n    }\n  }]);\n  return TextureManager;\n}(EventEmitter);\n_defineProperty(TextureManager, \"NEW_TEXTURE_EVENT\", \"newTexture\");\nvar _excluded = [\"drawHover\", \"drawLabel\", \"drawingMode\", \"keepWithinCircle\", \"padding\", \"colorAttribute\", \"imageAttribute\"];\nvar _WebGLRenderingContex = WebGLRenderingContext,\n  UNSIGNED_BYTE = _WebGLRenderingContex.UNSIGNED_BYTE,\n  FLOAT = _WebGLRenderingContex.FLOAT;\nvar DEFAULT_CREATE_NODE_IMAGE_OPTIONS = _objectSpread2(_objectSpread2({}, DEFAULT_TEXTURE_MANAGER_OPTIONS), {}, {\n  drawingMode: \"background\",\n  keepWithinCircle: true,\n  drawLabel: undefined,\n  drawHover: undefined,\n  padding: 0,\n  colorAttribute: \"color\",\n  imageAttribute: \"image\"\n});\nvar UNIFORMS = [\"u_sizeRatio\", \"u_correctionRatio\", \"u_cameraAngle\", \"u_percentagePadding\", \"u_matrix\", \"u_colorizeImages\", \"u_keepWithinCircle\", \"u_atlas\"];\n\n/**\n * To share the texture between the program instances of the graph and the\n * hovered nodes (to prevent some flickering, mostly), this program must be\n * \"built\" for each sigma instance:\n */\nfunction createNodeImageProgram(options) {\n  var _NodeImageProgram;\n  // Compute effective MAX_TEXTURE_SIZE from the current WebGL context:\n  var gl = document.createElement(\"canvas\").getContext(\"webgl\");\n  var defaultMaxTextureSize = Math.min(gl.getParameter(gl.MAX_TEXTURE_SIZE), DEFAULT_TEXTURE_MANAGER_OPTIONS.maxTextureSize);\n  gl.canvas.remove();\n  var _maxTextureSize = _objectSpread2(_objectSpread2(_objectSpread2({}, DEFAULT_CREATE_NODE_IMAGE_OPTIONS), {\n      maxTextureSize: defaultMaxTextureSize\n    }), options || {}),\n    drawHover = _maxTextureSize.drawHover,\n    drawLabel = _maxTextureSize.drawLabel,\n    drawingMode = _maxTextureSize.drawingMode,\n    keepWithinCircle = _maxTextureSize.keepWithinCircle,\n    padding = _maxTextureSize.padding,\n    colorAttribute = _maxTextureSize.colorAttribute,\n    imageAttribute = _maxTextureSize.imageAttribute,\n    textureManagerOptions = _objectWithoutProperties(_maxTextureSize, _excluded);\n\n  /**\n   * This texture manager is shared between all instances of this exact class,\n   * returned by this call to createNodeProgramImage. This means that\n   * remounting the sigma instance will not reload the images and regenerate\n   * the texture.\n   */\n  var textureManager = new TextureManager(textureManagerOptions);\n  return _NodeImageProgram = /*#__PURE__*/function (_NodeProgram) {\n    _inherits(NodeImageProgram, _NodeProgram);\n    function NodeImageProgram(gl, pickingBuffer, renderer) {\n      var _this;\n      _classCallCheck(this, NodeImageProgram);\n      _this = _callSuper(this, NodeImageProgram, [gl, pickingBuffer, renderer]);\n      _defineProperty(_assertThisInitialized(_this), \"drawLabel\", drawLabel);\n      _defineProperty(_assertThisInitialized(_this), \"drawHover\", drawHover);\n      _defineProperty(_assertThisInitialized(_this), \"textureManagerCallback\", null);\n      _this.textureManagerCallback = function (_ref) {\n        var atlas = _ref.atlas,\n          textures = _ref.textures;\n        var shouldUpgradeShaders = textures.length !== _this.textures.length;\n        _this.atlas = atlas;\n        _this.textureImages = textures;\n        if (shouldUpgradeShaders) _this.upgradeShaders();\n        _this.bindTextures();\n        if (_this.latestRenderParams) _this.render(_this.latestRenderParams);\n        if (_this.renderer && _this.renderer.refresh) _this.renderer.refresh();\n      };\n      textureManager.on(TextureManager.NEW_TEXTURE_EVENT, _this.textureManagerCallback);\n      _this.atlas = textureManager.getAtlas();\n      _this.textureImages = textureManager.getTextures();\n      _this.textures = _this.textureImages.map(function () {\n        return gl.createTexture();\n      });\n      _this.bindTextures();\n      return _this;\n    }\n    _createClass(NodeImageProgram, [{\n      key: \"getDefinition\",\n      value: function getDefinition() {\n        return {\n          VERTICES: 3,\n          VERTEX_SHADER_SOURCE: VERTEX_SHADER_SOURCE$1,\n          FRAGMENT_SHADER_SOURCE: getFragmentShader({\n            texturesCount: textureManager.getTextures().length\n          }),\n          METHOD: WebGLRenderingContext.TRIANGLES,\n          UNIFORMS: UNIFORMS,\n          ATTRIBUTES: [{\n            name: \"a_position\",\n            size: 2,\n            type: FLOAT\n          }, {\n            name: \"a_size\",\n            size: 1,\n            type: FLOAT\n          }, {\n            name: \"a_color\",\n            size: 4,\n            type: UNSIGNED_BYTE,\n            normalized: true\n          }, {\n            name: \"a_id\",\n            size: 4,\n            type: UNSIGNED_BYTE,\n            normalized: true\n          }, {\n            name: \"a_texture\",\n            size: 4,\n            type: FLOAT\n          }, {\n            name: \"a_textureIndex\",\n            size: 1,\n            type: FLOAT\n          }],\n          CONSTANT_ATTRIBUTES: [{\n            name: \"a_angle\",\n            size: 1,\n            type: FLOAT\n          }],\n          CONSTANT_DATA: [[NodeImageProgram.ANGLE_1], [NodeImageProgram.ANGLE_2], [NodeImageProgram.ANGLE_3]]\n        };\n      }\n    }, {\n      key: \"upgradeShaders\",\n      value: function upgradeShaders() {\n        var def = this.getDefinition();\n        var _this$normalProgram = this.normalProgram,\n          program = _this$normalProgram.program,\n          buffer = _this$normalProgram.buffer,\n          vertexShader = _this$normalProgram.vertexShader,\n          fragmentShader = _this$normalProgram.fragmentShader,\n          gl = _this$normalProgram.gl;\n        gl.deleteProgram(program);\n        gl.deleteBuffer(buffer);\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n        this.normalProgram = this.getProgramInfo(\"normal\", gl, def.VERTEX_SHADER_SOURCE, def.FRAGMENT_SHADER_SOURCE, null);\n      }\n    }, {\n      key: \"kill\",\n      value: function kill() {\n        var _this$normalProgram2;\n        var gl = (_this$normalProgram2 = this.normalProgram) === null || _this$normalProgram2 === void 0 ? void 0 : _this$normalProgram2.gl;\n        if (gl) {\n          for (var i = 0; i < this.textures.length; i++) {\n            gl.deleteTexture(this.textures[i]);\n          }\n        }\n        if (this.textureManagerCallback) {\n          textureManager.off(TextureManager.NEW_TEXTURE_EVENT, this.textureManagerCallback);\n          this.textureManagerCallback = null;\n        }\n        _superPropGet(NodeImageProgram, \"kill\", this, 3)([]);\n      }\n    }, {\n      key: \"bindTextures\",\n      value: function bindTextures() {\n        var gl = this.normalProgram.gl;\n        for (var i = 0; i < this.textureImages.length; i++) {\n          if (i >= this.textures.length) {\n            var texture = gl.createTexture();\n            if (texture) this.textures.push(texture);\n          }\n          gl.activeTexture(gl.TEXTURE0 + i);\n          gl.bindTexture(gl.TEXTURE_2D, this.textures[i]);\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.textureImages[i]);\n          gl.generateMipmap(gl.TEXTURE_2D);\n        }\n      }\n    }, {\n      key: \"renderProgram\",\n      value: function renderProgram(params, programInfo) {\n        if (!programInfo.isPicking) {\n          // Rebind texture (since it's been just unbound by picking):\n          var _gl = programInfo.gl;\n          for (var i = 0; i < this.textureImages.length; i++) {\n            _gl.activeTexture(_gl.TEXTURE0 + i);\n            _gl.bindTexture(_gl.TEXTURE_2D, this.textures[i]);\n          }\n        }\n        _superPropGet(NodeImageProgram, \"renderProgram\", this, 3)([params, programInfo]);\n      }\n    }, {\n      key: \"processVisibleItem\",\n      value: function processVisibleItem(nodeIndex, startIndex, data) {\n        var array = this.array;\n        var color = floatColor(data[colorAttribute]);\n        var imageSource = data[imageAttribute];\n        var imagePosition = imageSource ? this.atlas[imageSource] : undefined;\n        if (typeof imageSource === \"string\" && !imagePosition) textureManager.registerImage(imageSource);\n        array[startIndex++] = data.x;\n        array[startIndex++] = data.y;\n        array[startIndex++] = data.size;\n        array[startIndex++] = color;\n        array[startIndex++] = nodeIndex;\n\n        // Reference texture:\n        if (imagePosition && typeof imagePosition.textureIndex === \"number\") {\n          var _this$textureImages$i = this.textureImages[imagePosition.textureIndex],\n            width = _this$textureImages$i.width,\n            height = _this$textureImages$i.height;\n          array[startIndex++] = imagePosition.x / width;\n          array[startIndex++] = imagePosition.y / height;\n          array[startIndex++] = imagePosition.size / width;\n          array[startIndex++] = imagePosition.size / height;\n          array[startIndex++] = imagePosition.textureIndex;\n        } else {\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n        }\n      }\n    }, {\n      key: \"setUniforms\",\n      value: function setUniforms(params, _ref2) {\n        var gl = _ref2.gl,\n          uniformLocations = _ref2.uniformLocations;\n        var u_sizeRatio = uniformLocations.u_sizeRatio,\n          u_correctionRatio = uniformLocations.u_correctionRatio,\n          u_matrix = uniformLocations.u_matrix,\n          u_atlas = uniformLocations.u_atlas,\n          u_colorizeImages = uniformLocations.u_colorizeImages,\n          u_keepWithinCircle = uniformLocations.u_keepWithinCircle,\n          u_cameraAngle = uniformLocations.u_cameraAngle,\n          u_percentagePadding = uniformLocations.u_percentagePadding;\n        this.latestRenderParams = params;\n        gl.uniform1f(u_correctionRatio, params.correctionRatio);\n        gl.uniform1f(u_sizeRatio, keepWithinCircle ? params.sizeRatio : params.sizeRatio / Math.SQRT2);\n        gl.uniform1f(u_cameraAngle, params.cameraAngle);\n        gl.uniform1f(u_percentagePadding, padding);\n        gl.uniformMatrix3fv(u_matrix, false, params.matrix);\n        gl.uniform1iv(u_atlas, _toConsumableArray(new Array(this.textureImages.length)).map(function (_, i) {\n          return i;\n        }));\n        gl.uniform1i(u_colorizeImages, drawingMode === \"color\" ? 1 : 0);\n        gl.uniform1i(u_keepWithinCircle, keepWithinCircle ? 1 : 0);\n      }\n    }]);\n    return NodeImageProgram;\n  }(NodeProgram), _defineProperty(_NodeImageProgram, \"ANGLE_1\", 0), _defineProperty(_NodeImageProgram, \"ANGLE_2\", 2 * Math.PI / 3), _defineProperty(_NodeImageProgram, \"ANGLE_3\", 4 * Math.PI / 3), _defineProperty(_NodeImageProgram, \"textureManager\", textureManager), _NodeImageProgram;\n}\nvar NodeImageProgram = createNodeImageProgram();\nvar NodePictogramProgram = createNodeImageProgram({\n  keepWithinCircle: false,\n  size: {\n    mode: \"force\",\n    value: 256\n  },\n  drawingMode: \"color\",\n  correctCentering: true\n});\nexport { NodeImageProgram, NodePictogramProgram, createNodeImageProgram };","map":{"version":3,"names":["NodeProgram","floatColor","EventEmitter","_arrayLikeToArray","r","a","length","e","n","Array","_arrayWithoutHoles","isArray","_iterableToArray","Symbol","iterator","from","_unsupportedIterableToArray","t","toString","call","slice","constructor","name","test","_nonIterableSpread","TypeError","_toConsumableArray","_classCallCheck","_toPrimitive","toPrimitive","i","String","Number","_toPropertyKey","_defineProperties","o","enumerable","configurable","writable","Object","defineProperty","key","_createClass","prototype","_getPrototypeOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_isNativeReflectConstruct","Boolean","valueOf","Reflect","construct","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_callSuper","apply","_superPropBase","hasOwnProperty","_get","get","p","getOwnPropertyDescriptor","arguments","value","_superPropGet","_setPrototypeOf","_inherits","create","_defineProperty","_objectWithoutPropertiesLoose","includes","_objectWithoutProperties","getOwnPropertySymbols","s","propertyIsEnumerable","ownKeys","keys","filter","push","_objectSpread2","forEach","getOwnPropertyDescriptors","defineProperties","getFragmentShader","_ref","texturesCount","SHADER","concat","Math","SQRT2","map","_","join","SQRT1_2","cos","PI","VERTEX_SHADER_SOURCE","VERTEX_SHADER_SOURCE$1","_regeneratorRuntime","c","asyncIterator","u","toStringTag","define","wrap","Generator","Context","makeInvokeMethod","tryCatch","type","arg","h","l","f","y","GeneratorFunction","GeneratorFunctionPrototype","d","v","values","g","defineIteratorMethods","_invoke","AsyncIterator","invoke","resolve","__await","then","callInvokeWithMethodAndArg","Error","done","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","return","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","isNaN","displayName","isGeneratorFunction","mark","awrap","async","Promise","reverse","pop","prev","charAt","stop","rval","handle","complete","finish","catch","delegateYield","asyncGeneratorStep","_asyncToGenerator","_next","_throw","DEFAULT_TEXTURE_MANAGER_OPTIONS","size","mode","objectFit","correctCentering","maxTextureSize","debounceTimeout","crossOrigin","MARGIN_IN_TEXTURE","loadRasterImage","imageSource","undefined","reject","image","Image","addEventListener","once","error","setAttribute","src","loadSVGImage","_x","_loadSVGImage","_callee2","_ref2","resp","svgString","svg","root","originalWidth","originalHeight","correctedSvgString","blob","url","res","_args2","_callee2$","_context2","fetch","credentials","text","DOMParser","parseFromString","documentElement","getAttribute","XMLSerializer","serializeToString","Blob","URL","createObjectURL","revokeObjectURL","loadImage","_x2","_loadImage","_callee3","_imageSource$split$0$","_ref3","isSVG","_args3","_callee3$","_context3","split","trim","toLowerCase","t0","refineImage","corrector","_ref4","sourceSize","max","width","height","min","destinationSize","sourceX","sourceY","correction","getCorrectionOffset","x","drawTexture","images","ctx","cursor","_ctx$canvas","canvas","refinedImagesArray","rowHeight","maxRowWidth","atlas","_images$i","destinationSizeWithMargin","destinationX","destinationY","effectiveWidth","effectiveHeight","_i","_l","_refinedImagesArray$_","_image","_sourceSize","_sourceX","_sourceY","_destinationSize","drawImage","texture","getImageData","drawTextures","_ref5","prevAtlas","prevTextures","textures","prevCursor","imagesToDraw","_prevAtlas$key","imageState","status","textureIndex","_loop","_drawTexture","remainingImages","clearRect","PictogramCenteringCorrector","document","createElement","context","getContext","willReadFrequently","data","alpha","Uint8ClampedArray","sumX","sumY","total","barycenterX","barycenterY","TextureManager","_EventEmitter","_this","options","scheduleGenerateTexture","_this2","frameId","window","setTimeout","generateTextures","_drawTextures","lastTextureCursor","imageStates","emit","NEW_TEXTURE_EVENT","_registerImage","_callee","source","_callee$","_context","registerImage","_x3","getAtlas","getTextures","_excluded","_WebGLRenderingContex","WebGLRenderingContext","UNSIGNED_BYTE","FLOAT","DEFAULT_CREATE_NODE_IMAGE_OPTIONS","drawingMode","keepWithinCircle","drawLabel","drawHover","padding","colorAttribute","imageAttribute","UNIFORMS","createNodeImageProgram","_NodeImageProgram","gl","defaultMaxTextureSize","getParameter","MAX_TEXTURE_SIZE","remove","_maxTextureSize","textureManagerOptions","textureManager","_NodeProgram","NodeImageProgram","pickingBuffer","renderer","textureManagerCallback","shouldUpgradeShaders","textureImages","upgradeShaders","bindTextures","latestRenderParams","render","refresh","on","createTexture","getDefinition","VERTICES","FRAGMENT_SHADER_SOURCE","METHOD","TRIANGLES","ATTRIBUTES","normalized","CONSTANT_ATTRIBUTES","CONSTANT_DATA","ANGLE_1","ANGLE_2","ANGLE_3","def","_this$normalProgram","normalProgram","program","buffer","vertexShader","fragmentShader","deleteProgram","deleteBuffer","deleteShader","getProgramInfo","kill","_this$normalProgram2","deleteTexture","off","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texImage2D","RGBA","generateMipmap","renderProgram","params","programInfo","isPicking","_gl","processVisibleItem","nodeIndex","startIndex","array","color","imagePosition","_this$textureImages$i","setUniforms","uniformLocations","u_sizeRatio","u_correctionRatio","u_matrix","u_atlas","u_colorizeImages","u_keepWithinCircle","u_cameraAngle","u_percentagePadding","uniform1f","correctionRatio","sizeRatio","cameraAngle","uniformMatrix3fv","matrix","uniform1iv","uniform1i","NodePictogramProgram"],"sources":["/Users/fjodoin/Desktop/Research/AzureRT/azure_resource_graph/training/graphing/sigma-graph/node_modules/@sigma/node-image/dist/sigma-node-image.esm.js"],"sourcesContent":["import { NodeProgram } from 'sigma/rendering';\nimport { floatColor } from 'sigma/utils';\nimport { EventEmitter } from 'events';\n\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\n\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\n\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\n\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\n\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\n\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\n\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\n\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\n\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\n\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\n\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\n\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\n\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\n\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n  return t;\n}\n\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = _superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\n\nfunction _superPropGet(t, o, e, r) {\n  var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e);\n  return 2 & r && \"function\" == typeof p ? function (t) {\n    return p.apply(e, t);\n  } : p;\n}\n\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\n\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: !0,\n      configurable: !0\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: !1\n  }), e && _setPrototypeOf(t, e);\n}\n\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\n\nfunction _objectWithoutPropertiesLoose(r, e) {\n  if (null == r) return {};\n  var t = {};\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\n    if (e.includes(n)) continue;\n    t[n] = r[n];\n  }\n  return t;\n}\n\nfunction _objectWithoutProperties(e, t) {\n  if (null == e) return {};\n  var o,\n    r,\n    i = _objectWithoutPropertiesLoose(e, t);\n  if (Object.getOwnPropertySymbols) {\n    var s = Object.getOwnPropertySymbols(e);\n    for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\n  }\n  return i;\n}\n\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\n\nfunction getFragmentShader(_ref) {\n  var texturesCount = _ref.texturesCount;\n  // language=GLSL\n  var SHADER = /*glsl*/\"\\nprecision highp float;\\n\\nvarying vec4 v_color;\\nvarying vec2 v_diffVector;\\nvarying float v_radius;\\nvarying vec4 v_texture;\\nvarying float v_textureIndex;\\n\\nuniform sampler2D u_atlas[\".concat(texturesCount, \"];\\nuniform float u_correctionRatio;\\nuniform float u_cameraAngle;\\nuniform float u_percentagePadding;\\nuniform bool u_colorizeImages;\\nuniform bool u_keepWithinCircle;\\n\\nconst vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);\\n\\nconst float radius = 0.5;\\n\\nvoid main(void) {\\n  float border = 2.0 * u_correctionRatio;\\n  float dist = length(v_diffVector);\\n  vec4 color = gl_FragColor;\\n\\n  float c = cos(-u_cameraAngle);\\n  float s = sin(-u_cameraAngle);\\n  vec2 diffVector = mat2(c, s, -s, c) * (v_diffVector);\\n\\n  // No antialiasing for picking mode:\\n  #ifdef PICKING_MODE\\n  border = 0.0;\\n  color = v_color;\\n\\n  #else\\n  // First case: No image to display\\n  if (v_texture.w <= 0.0) {\\n    if (!u_colorizeImages) {\\n      color = v_color;\\n    }\\n  }\\n\\n  // Second case: Image loaded into the texture\\n  else {\\n    float paddingRatio = 1.0 + 2.0 * u_percentagePadding;\\n    float coef = u_keepWithinCircle ? 1.0 : \").concat(Math.SQRT2, \";\\n    vec2 coordinateInTexture = diffVector * vec2(paddingRatio, -paddingRatio) / v_radius / 2.0 * coef + vec2(0.5, 0.5);\\n    int index = int(v_textureIndex + 0.5); // +0.5 avoid rounding errors\\n\\n    bool noTextureFound = false;\\n    vec4 texel;\\n\\n    \").concat(_toConsumableArray(new Array(texturesCount)).map(function (_, i) {\n    return \"if (index == \".concat(i, \") texel = texture2D(u_atlas[\").concat(i, \"], (v_texture.xy + coordinateInTexture * v_texture.zw), -1.0);\");\n  }).join(\"\\n    else \") + \"else {\\n      texel = texture2D(u_atlas[0], (v_texture.xy + coordinateInTexture * v_texture.zw), -1.0);\\n      noTextureFound = true;\\n    }\", \"\\n\\n    if (noTextureFound) {\\n      color = v_color;\\n    } else {\\n      // Colorize all visible image pixels:\\n      if (u_colorizeImages) {\\n        color = mix(gl_FragColor, v_color, texel.a);\\n      }\\n\\n      // Colorize background pixels, keep image pixel colors:\\n      else {\\n        color = vec4(mix(v_color, texel, texel.a).rgb, max(texel.a, v_color.a));\\n      }\\n\\n      // Erase pixels \\\"in the padding\\\":\\n      if (abs(diffVector.x) > v_radius / paddingRatio || abs(diffVector.y) > v_radius / paddingRatio) {\\n        color = u_colorizeImages ? gl_FragColor : v_color;\\n      }\\n    }\\n  }\\n  #endif\\n\\n  // Crop in a circle when u_keepWithinCircle is truthy:\\n  if (u_keepWithinCircle) {\\n    if (dist < v_radius - border) {\\n      gl_FragColor = color;\\n    } else if (dist < v_radius) {\\n      gl_FragColor = mix(transparent, color, (v_radius - dist) / border);\\n    }\\n  }\\n\\n  // Crop in a square else:\\n  else {\\n    float squareHalfSize = v_radius * \").concat(Math.SQRT1_2 * Math.cos(Math.PI / 12), \";\\n    if (abs(diffVector.x) > squareHalfSize || abs(diffVector.y) > squareHalfSize) {\\n      gl_FragColor = transparent;\\n    } else {\\n      gl_FragColor = color;\\n    }\\n  }\\n}\\n\");\n  return SHADER;\n}\n\n// language=GLSL\nvar VERTEX_SHADER_SOURCE = /*glsl*/\"\\nattribute vec4 a_id;\\nattribute vec4 a_color;\\nattribute vec2 a_position;\\nattribute float a_size;\\nattribute float a_angle;\\nattribute vec4 a_texture;\\nattribute float a_textureIndex;\\n\\nuniform mat3 u_matrix;\\nuniform float u_sizeRatio;\\nuniform float u_correctionRatio;\\n\\nvarying vec4 v_color;\\nvarying vec2 v_diffVector;\\nvarying float v_radius;\\nvarying vec4 v_texture;\\nvarying float v_textureIndex;\\n\\nconst float bias = 255.0 / 254.0;\\nconst float marginRatio = 1.05;\\n\\nvoid main() {\\n  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;\\n  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));\\n  vec2 position = a_position + diffVector * marginRatio;\\n  gl_Position = vec4(\\n    (u_matrix * vec3(position, 1)).xy,\\n    0,\\n    1\\n  );\\n\\n  v_diffVector = diffVector;\\n  v_radius = size / 2.0 / marginRatio;\\n\\n  #ifdef PICKING_MODE\\n  // For picking mode, we use the ID as the color:\\n  v_color = a_id;\\n  #else\\n  // For normal mode, we use the color:\\n  v_color = a_color;\\n\\n  // Pass the texture coordinates:\\n  v_textureIndex = a_textureIndex;\\n  v_texture = a_texture;\\n  #endif\\n\\n  v_color.a *= bias;\\n}\\n\";\nvar VERTEX_SHADER_SOURCE$1 = VERTEX_SHADER_SOURCE;\n\nfunction _regeneratorRuntime() {\n  _regeneratorRuntime = function () {\n    return e;\n  };\n  var t,\n    e = {},\n    r = Object.prototype,\n    n = r.hasOwnProperty,\n    o = Object.defineProperty || function (t, e, r) {\n      t[e] = r.value;\n    },\n    i = \"function\" == typeof Symbol ? Symbol : {},\n    a = i.iterator || \"@@iterator\",\n    c = i.asyncIterator || \"@@asyncIterator\",\n    u = i.toStringTag || \"@@toStringTag\";\n  function define(t, e, r) {\n    return Object.defineProperty(t, e, {\n      value: r,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), t[e];\n  }\n  try {\n    define({}, \"\");\n  } catch (t) {\n    define = function (t, e, r) {\n      return t[e] = r;\n    };\n  }\n  function wrap(t, e, r, n) {\n    var i = e && e.prototype instanceof Generator ? e : Generator,\n      a = Object.create(i.prototype),\n      c = new Context(n || []);\n    return o(a, \"_invoke\", {\n      value: makeInvokeMethod(t, r, c)\n    }), a;\n  }\n  function tryCatch(t, e, r) {\n    try {\n      return {\n        type: \"normal\",\n        arg: t.call(e, r)\n      };\n    } catch (t) {\n      return {\n        type: \"throw\",\n        arg: t\n      };\n    }\n  }\n  e.wrap = wrap;\n  var h = \"suspendedStart\",\n    l = \"suspendedYield\",\n    f = \"executing\",\n    s = \"completed\",\n    y = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  var p = {};\n  define(p, a, function () {\n    return this;\n  });\n  var d = Object.getPrototypeOf,\n    v = d && d(d(values([])));\n  v && v !== r && n.call(v, a) && (p = v);\n  var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);\n  function defineIteratorMethods(t) {\n    [\"next\", \"throw\", \"return\"].forEach(function (e) {\n      define(t, e, function (t) {\n        return this._invoke(e, t);\n      });\n    });\n  }\n  function AsyncIterator(t, e) {\n    function invoke(r, o, i, a) {\n      var c = tryCatch(t[r], t, o);\n      if (\"throw\" !== c.type) {\n        var u = c.arg,\n          h = u.value;\n        return h && \"object\" == typeof h && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) {\n          invoke(\"next\", t, i, a);\n        }, function (t) {\n          invoke(\"throw\", t, i, a);\n        }) : e.resolve(h).then(function (t) {\n          u.value = t, i(u);\n        }, function (t) {\n          return invoke(\"throw\", t, i, a);\n        });\n      }\n      a(c.arg);\n    }\n    var r;\n    o(this, \"_invoke\", {\n      value: function (t, n) {\n        function callInvokeWithMethodAndArg() {\n          return new e(function (e, r) {\n            invoke(t, n, e, r);\n          });\n        }\n        return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      }\n    });\n  }\n  function makeInvokeMethod(e, r, n) {\n    var o = h;\n    return function (i, a) {\n      if (o === f) throw Error(\"Generator is already running\");\n      if (o === s) {\n        if (\"throw\" === i) throw a;\n        return {\n          value: t,\n          done: !0\n        };\n      }\n      for (n.method = i, n.arg = a;;) {\n        var c = n.delegate;\n        if (c) {\n          var u = maybeInvokeDelegate(c, n);\n          if (u) {\n            if (u === y) continue;\n            return u;\n          }\n        }\n        if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) {\n          if (o === h) throw o = s, n.arg;\n          n.dispatchException(n.arg);\n        } else \"return\" === n.method && n.abrupt(\"return\", n.arg);\n        o = f;\n        var p = tryCatch(e, r, n);\n        if (\"normal\" === p.type) {\n          if (o = n.done ? s : l, p.arg === y) continue;\n          return {\n            value: p.arg,\n            done: n.done\n          };\n        }\n        \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg);\n      }\n    };\n  }\n  function maybeInvokeDelegate(e, r) {\n    var n = r.method,\n      o = e.iterator[n];\n    if (o === t) return r.delegate = null, \"throw\" === n && e.iterator.return && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y;\n    var i = tryCatch(o, e.iterator, r.arg);\n    if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y;\n    var a = i.arg;\n    return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y);\n  }\n  function pushTryEntry(t) {\n    var e = {\n      tryLoc: t[0]\n    };\n    1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);\n  }\n  function resetTryEntry(t) {\n    var e = t.completion || {};\n    e.type = \"normal\", delete e.arg, t.completion = e;\n  }\n  function Context(t) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], t.forEach(pushTryEntry, this), this.reset(!0);\n  }\n  function values(e) {\n    if (e || \"\" === e) {\n      var r = e[a];\n      if (r) return r.call(e);\n      if (\"function\" == typeof e.next) return e;\n      if (!isNaN(e.length)) {\n        var o = -1,\n          i = function next() {\n            for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;\n            return next.value = t, next.done = !0, next;\n          };\n        return i.next = i;\n      }\n    }\n    throw new TypeError(typeof e + \" is not iterable\");\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", {\n    value: GeneratorFunctionPrototype,\n    configurable: !0\n  }), o(GeneratorFunctionPrototype, \"constructor\", {\n    value: GeneratorFunction,\n    configurable: !0\n  }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) {\n    var e = \"function\" == typeof t && t.constructor;\n    return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name));\n  }, e.mark = function (t) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t;\n  }, e.awrap = function (t) {\n    return {\n      __await: t\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {\n    return this;\n  }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {\n    void 0 === i && (i = Promise);\n    var a = new AsyncIterator(wrap(t, r, n, o), i);\n    return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {\n      return t.done ? t.value : a.next();\n    });\n  }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () {\n    return this;\n  }), define(g, \"toString\", function () {\n    return \"[object Generator]\";\n  }), e.keys = function (t) {\n    var e = Object(t),\n      r = [];\n    for (var n in e) r.push(n);\n    return r.reverse(), function next() {\n      for (; r.length;) {\n        var t = r.pop();\n        if (t in e) return next.value = t, next.done = !1, next;\n      }\n      return next.done = !0, next;\n    };\n  }, e.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function (e) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);\n    },\n    stop: function () {\n      this.done = !0;\n      var t = this.tryEntries[0].completion;\n      if (\"throw\" === t.type) throw t.arg;\n      return this.rval;\n    },\n    dispatchException: function (e) {\n      if (this.done) throw e;\n      var r = this;\n      function handle(n, o) {\n        return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o;\n      }\n      for (var o = this.tryEntries.length - 1; o >= 0; --o) {\n        var i = this.tryEntries[o],\n          a = i.completion;\n        if (\"root\" === i.tryLoc) return handle(\"end\");\n        if (i.tryLoc <= this.prev) {\n          var c = n.call(i, \"catchLoc\"),\n            u = n.call(i, \"finallyLoc\");\n          if (c && u) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          } else if (c) {\n            if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);\n          } else {\n            if (!u) throw Error(\"try statement without catch or finally\");\n            if (this.prev < i.finallyLoc) return handle(i.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function (t, e) {\n      for (var r = this.tryEntries.length - 1; r >= 0; --r) {\n        var o = this.tryEntries[r];\n        if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) {\n          var i = o;\n          break;\n        }\n      }\n      i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);\n      var a = i ? i.completion : {};\n      return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a);\n    },\n    complete: function (t, e) {\n      if (\"throw\" === t.type) throw t.arg;\n      return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y;\n    },\n    finish: function (t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;\n      }\n    },\n    catch: function (t) {\n      for (var e = this.tryEntries.length - 1; e >= 0; --e) {\n        var r = this.tryEntries[e];\n        if (r.tryLoc === t) {\n          var n = r.completion;\n          if (\"throw\" === n.type) {\n            var o = n.arg;\n            resetTryEntry(r);\n          }\n          return o;\n        }\n      }\n      throw Error(\"illegal catch attempt\");\n    },\n    delegateYield: function (e, r, n) {\n      return this.delegate = {\n        iterator: values(e),\n        resultName: r,\n        nextLoc: n\n      }, \"next\" === this.method && (this.arg = t), y;\n    }\n  }, e;\n}\n\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\n\n/**\n * Useful types:\n * *************\n */\n\nvar DEFAULT_TEXTURE_MANAGER_OPTIONS = {\n  size: {\n    mode: \"max\",\n    value: 512\n  },\n  objectFit: \"cover\",\n  correctCentering: false,\n  maxTextureSize: 4096,\n  debounceTimeout: 500,\n  crossOrigin: \"anonymous\"\n};\n\n// This margin helps to avoid images collisions in the texture:\nvar MARGIN_IN_TEXTURE = 1;\n\n/**\n * Helpers:\n * ********\n */\n/**\n * This helper loads an image at a given URL, and returns an HTMLImageElement\n * with it displayed once it's properly loaded, within a promise.\n */\nfunction loadRasterImage(imageSource) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    crossOrigin = _ref.crossOrigin;\n  return new Promise(function (resolve, reject) {\n    var image = new Image();\n    image.addEventListener(\"load\", function () {\n      resolve(image);\n    }, {\n      once: true\n    });\n    image.addEventListener(\"error\", function (e) {\n      reject(e.error);\n    }, {\n      once: true\n    });\n\n    // Load image:\n    if (crossOrigin) {\n      image.setAttribute(\"crossOrigin\", crossOrigin);\n    }\n    image.src = imageSource;\n  });\n}\n\n/**\n * This helper loads an SVG image at a given URL, adjusts its size to a given\n * size, and returns an HTMLImageElement with it displayed once it's properly\n * loaded, within a promise.\n */\nfunction loadSVGImage(_x) {\n  return _loadSVGImage.apply(this, arguments);\n}\n\n/**\n * This helper loads an image using the proper function.\n */\nfunction _loadSVGImage() {\n  _loadSVGImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(imageSource) {\n    var _ref2,\n      size,\n      crossOrigin,\n      resp,\n      svgString,\n      svg,\n      root,\n      originalWidth,\n      originalHeight,\n      correctedSvgString,\n      blob,\n      url,\n      res,\n      _args2 = arguments;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _ref2 = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : {}, size = _ref2.size, crossOrigin = _ref2.crossOrigin;\n          if (!(crossOrigin === \"use-credentials\")) {\n            _context2.next = 7;\n            break;\n          }\n          _context2.next = 4;\n          return fetch(imageSource, {\n            credentials: \"include\"\n          });\n        case 4:\n          resp = _context2.sent;\n          _context2.next = 10;\n          break;\n        case 7:\n          _context2.next = 9;\n          return fetch(imageSource);\n        case 9:\n          resp = _context2.sent;\n        case 10:\n          _context2.next = 12;\n          return resp.text();\n        case 12:\n          svgString = _context2.sent;\n          svg = new DOMParser().parseFromString(svgString, \"image/svg+xml\");\n          root = svg.documentElement;\n          originalWidth = root.getAttribute(\"width\");\n          originalHeight = root.getAttribute(\"height\");\n          if (!(!originalWidth || !originalHeight)) {\n            _context2.next = 19;\n            break;\n          }\n          throw new Error(\"loadSVGImage: cannot use `size` if target SVG has no definite dimensions.\");\n        case 19:\n          if (typeof size === \"number\") {\n            root.setAttribute(\"width\", \"\" + size);\n            root.setAttribute(\"height\", \"\" + size);\n          }\n\n          // NOTE: since Google Material last changes to their icon viewBox, this\n          // code is no longer necessary (hopefully it does not break something else...)\n          // root.setAttribute(\"viewBox\", `0 0 ${originalWidth} ${originalHeight}`);\n          correctedSvgString = new XMLSerializer().serializeToString(svg);\n          blob = new Blob([correctedSvgString], {\n            type: \"image/svg+xml\"\n          });\n          url = URL.createObjectURL(blob);\n          res = loadRasterImage(url);\n          res[\"finally\"](function () {\n            return URL.revokeObjectURL(url);\n          });\n          return _context2.abrupt(\"return\", res);\n        case 26:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return _loadSVGImage.apply(this, arguments);\n}\nfunction loadImage(_x2) {\n  return _loadImage.apply(this, arguments);\n}\n\n/**\n * This helper computes exact coordinates to draw an image onto a texture.\n */\nfunction _loadImage() {\n  _loadImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(imageSource) {\n    var _imageSource$split$0$;\n    var _ref3,\n      size,\n      crossOrigin,\n      isSVG,\n      image,\n      _args3 = arguments;\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _ref3 = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {}, size = _ref3.size, crossOrigin = _ref3.crossOrigin;\n          isSVG = ((_imageSource$split$0$ = imageSource.split(/[#?]/)[0].split(\".\").pop()) === null || _imageSource$split$0$ === void 0 ? void 0 : _imageSource$split$0$.trim().toLowerCase()) === \"svg\";\n          if (!(isSVG && size)) {\n            _context3.next = 16;\n            break;\n          }\n          _context3.prev = 3;\n          _context3.next = 6;\n          return loadSVGImage(imageSource, {\n            size: size,\n            crossOrigin: crossOrigin\n          });\n        case 6:\n          image = _context3.sent;\n          _context3.next = 14;\n          break;\n        case 9:\n          _context3.prev = 9;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 13;\n          return loadRasterImage(imageSource, {\n            crossOrigin: crossOrigin\n          });\n        case 13:\n          image = _context3.sent;\n        case 14:\n          _context3.next = 19;\n          break;\n        case 16:\n          _context3.next = 18;\n          return loadRasterImage(imageSource, {\n            crossOrigin: crossOrigin\n          });\n        case 18:\n          image = _context3.sent;\n        case 19:\n          return _context3.abrupt(\"return\", image);\n        case 20:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[3, 9]]);\n  }));\n  return _loadImage.apply(this, arguments);\n}\nfunction refineImage(image, corrector, _ref4) {\n  var objectFit = _ref4.objectFit,\n    size = _ref4.size,\n    correctCentering = _ref4.correctCentering;\n  var sourceSize = objectFit === \"contain\" ? Math.max(image.width, image.height) : Math.min(image.width, image.height);\n  var destinationSize = size.mode === \"auto\" ? sourceSize : size.mode === \"force\" ? size.value : Math.min(size.value, sourceSize);\n  var sourceX = (image.width - sourceSize) / 2;\n  var sourceY = (image.height - sourceSize) / 2;\n  if (correctCentering) {\n    var correction = corrector.getCorrectionOffset(image, sourceSize);\n    sourceX = correction.x;\n    sourceY = correction.y;\n  }\n  return {\n    sourceX: sourceX,\n    sourceY: sourceY,\n    sourceSize: sourceSize,\n    destinationSize: destinationSize\n  };\n}\n\n/**\n * This helper takes an array of ready-to-draw images, and draws as much as possible in a single texture.\n * It then returns the atlas of the draw images, as well as the texture itself.\n */\nfunction drawTexture(images, ctx, cursor) {\n  var _ctx$canvas = ctx.canvas,\n    width = _ctx$canvas.width,\n    height = _ctx$canvas.height;\n\n  // Refine images coordinates:\n  var refinedImagesArray = [];\n  var x = cursor.x,\n    y = cursor.y,\n    rowHeight = cursor.rowHeight,\n    maxRowWidth = cursor.maxRowWidth;\n  var atlas = {};\n  for (var i = 0, l = images.length; i < l; i++) {\n    var _images$i = images[i],\n      key = _images$i.key,\n      image = _images$i.image,\n      sourceSize = _images$i.sourceSize,\n      sourceX = _images$i.sourceX,\n      sourceY = _images$i.sourceY,\n      destinationSize = _images$i.destinationSize;\n    var destinationSizeWithMargin = destinationSize + MARGIN_IN_TEXTURE;\n\n    // If the image does not fit, just skip it:\n    if (y + destinationSizeWithMargin > height || x + destinationSizeWithMargin > width && y + destinationSizeWithMargin + rowHeight > height) {\n      continue;\n    }\n    if (x + destinationSizeWithMargin > width) {\n      maxRowWidth = Math.max(maxRowWidth, x);\n      x = 0;\n      y += rowHeight;\n      rowHeight = destinationSizeWithMargin;\n    }\n    refinedImagesArray.push({\n      key: key,\n      image: image,\n      sourceX: sourceX,\n      sourceY: sourceY,\n      sourceSize: sourceSize,\n      destinationX: x,\n      destinationY: y,\n      destinationSize: destinationSize\n    });\n    atlas[key] = {\n      x: x,\n      y: y,\n      size: destinationSize\n    };\n    x += destinationSizeWithMargin;\n    rowHeight = Math.max(rowHeight, destinationSizeWithMargin);\n  }\n\n  // Crop texture to final best dimensions:\n  maxRowWidth = Math.max(maxRowWidth, x);\n  var effectiveWidth = maxRowWidth;\n  var effectiveHeight = y + rowHeight;\n\n  // Fill texture:\n  for (var _i = 0, _l = refinedImagesArray.length; _i < _l; _i++) {\n    var _refinedImagesArray$_ = refinedImagesArray[_i],\n      _image = _refinedImagesArray$_.image,\n      _sourceSize = _refinedImagesArray$_.sourceSize,\n      _sourceX = _refinedImagesArray$_.sourceX,\n      _sourceY = _refinedImagesArray$_.sourceY,\n      _destinationSize = _refinedImagesArray$_.destinationSize,\n      destinationX = _refinedImagesArray$_.destinationX,\n      destinationY = _refinedImagesArray$_.destinationY;\n    ctx.drawImage(_image, _sourceX, _sourceY, _sourceSize, _sourceSize, destinationX, destinationY, _destinationSize, _destinationSize);\n  }\n  return {\n    atlas: atlas,\n    texture: ctx.getImageData(0, 0, effectiveWidth, effectiveHeight),\n    cursor: {\n      x: x,\n      y: y,\n      rowHeight: rowHeight,\n      maxRowWidth: maxRowWidth\n    }\n  };\n}\n\n/**\n * This helper takes a collection of image states and a context, draw all the\n * images in the context, and returns an atlas to get where each image is drawn\n * on the texture.\n */\nfunction drawTextures(_ref5, images, ctx) {\n  var prevAtlas = _ref5.atlas,\n    prevTextures = _ref5.textures,\n    prevCursor = _ref5.cursor;\n  var res = {\n    atlas: _objectSpread2({}, prevAtlas),\n    textures: _toConsumableArray(prevTextures.slice(0, -1)),\n    cursor: _objectSpread2({}, prevCursor)\n  };\n\n  // Extract images that are ready to draw, but not drawn yet:\n  var imagesToDraw = [];\n  for (var key in images) {\n    var _prevAtlas$key;\n    // Skip images that are not ready yet:\n    var imageState = images[key];\n    if (imageState.status !== \"ready\") continue;\n\n    // Skip all images that already exist in a texture:\n    var textureIndex = (_prevAtlas$key = prevAtlas[key]) === null || _prevAtlas$key === void 0 ? void 0 : _prevAtlas$key.textureIndex;\n    if (typeof textureIndex === \"number\") continue;\n\n    // Keep all the rest:\n    imagesToDraw.push(_objectSpread2({\n      key: key\n    }, imageState));\n  }\n\n  // Draw remaining images on new textures until there are none remaining:\n  var _loop = function _loop() {\n    var _drawTexture = drawTexture(imagesToDraw, ctx, res.cursor),\n      atlas = _drawTexture.atlas,\n      texture = _drawTexture.texture,\n      cursor = _drawTexture.cursor;\n    res.cursor = cursor;\n    var remainingImages = [];\n    imagesToDraw.forEach(function (image) {\n      if (atlas[image.key]) {\n        res.atlas[image.key] = _objectSpread2(_objectSpread2({}, atlas[image.key]), {}, {\n          textureIndex: res.textures.length\n        });\n      } else {\n        remainingImages.push(image);\n      }\n    });\n    res.textures.push(texture);\n    imagesToDraw = remainingImages;\n    if (imagesToDraw.length) {\n      res.cursor = {\n        x: 0,\n        y: 0,\n        rowHeight: 0,\n        maxRowWidth: 0\n      };\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    }\n  };\n  while (imagesToDraw.length) {\n    _loop();\n  }\n  return res;\n}\n\n/**\n * This class helps to \"correct\" the centering of an SVG pictogram by finding\n * the \"true\" visually correct center through the barycenter of the pictogram's\n * alpha layer in x and y dimension.\n */\nvar PictogramCenteringCorrector = /*#__PURE__*/function () {\n  function PictogramCenteringCorrector() {\n    _classCallCheck(this, PictogramCenteringCorrector);\n    this.canvas = document.createElement(\"canvas\");\n    this.context = this.canvas.getContext(\"2d\", {\n      willReadFrequently: true\n    });\n  }\n  _createClass(PictogramCenteringCorrector, [{\n    key: \"getCorrectionOffset\",\n    value: function getCorrectionOffset(image, size) {\n      this.canvas.width = size;\n      this.canvas.height = size;\n      this.context.clearRect(0, 0, size, size);\n      this.context.drawImage(image, 0, 0, size, size);\n      var data = this.context.getImageData(0, 0, size, size).data;\n      var alpha = new Uint8ClampedArray(data.length / 4);\n      for (var i = 0; i < data.length; i++) {\n        alpha[i] = data[i * 4 + 3];\n      }\n      var sumX = 0;\n      var sumY = 0;\n      var total = 0;\n      for (var y = 0; y < size; y++) {\n        for (var x = 0; x < size; x++) {\n          var a = alpha[y * size + x];\n          total += a;\n          sumX += a * x;\n          sumY += a * y;\n        }\n      }\n      var barycenterX = sumX / total;\n      var barycenterY = sumY / total;\n      return {\n        x: barycenterX - size / 2,\n        y: barycenterY - size / 2\n      };\n    }\n  }]);\n  return PictogramCenteringCorrector;\n}();\nvar TextureManager = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(TextureManager, _EventEmitter);\n  function TextureManager() {\n    var _this;\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, TextureManager);\n    _this = _callSuper(this, TextureManager);\n    _defineProperty(_assertThisInitialized(_this), \"canvas\", document.createElement(\"canvas\"));\n    _defineProperty(_assertThisInitialized(_this), \"ctx\", _this.canvas.getContext(\"2d\", {\n      willReadFrequently: true\n    }));\n    _defineProperty(_assertThisInitialized(_this), \"corrector\", new PictogramCenteringCorrector());\n    _defineProperty(_assertThisInitialized(_this), \"imageStates\", {});\n    _defineProperty(_assertThisInitialized(_this), \"textures\", [_this.ctx.getImageData(0, 0, 1, 1)]);\n    _defineProperty(_assertThisInitialized(_this), \"lastTextureCursor\", {\n      x: 0,\n      y: 0,\n      rowHeight: 0,\n      maxRowWidth: 0\n    });\n    _defineProperty(_assertThisInitialized(_this), \"atlas\", {});\n    _this.options = _objectSpread2(_objectSpread2({}, DEFAULT_TEXTURE_MANAGER_OPTIONS), options);\n    _this.canvas.width = _this.options.maxTextureSize;\n    _this.canvas.height = _this.options.maxTextureSize;\n    return _this;\n  }\n  _createClass(TextureManager, [{\n    key: \"scheduleGenerateTexture\",\n    value: function scheduleGenerateTexture() {\n      var _this2 = this;\n      if (typeof this.frameId === \"number\") return;\n      if (typeof this.options.debounceTimeout === \"number\") {\n        this.frameId = window.setTimeout(function () {\n          _this2.generateTextures();\n          _this2.frameId = undefined;\n        }, this.options.debounceTimeout);\n      } else {\n        this.generateTextures();\n      }\n    }\n  }, {\n    key: \"generateTextures\",\n    value: function generateTextures() {\n      var _drawTextures = drawTextures({\n          atlas: this.atlas,\n          textures: this.textures,\n          cursor: this.lastTextureCursor\n        }, this.imageStates, this.ctx),\n        atlas = _drawTextures.atlas,\n        textures = _drawTextures.textures,\n        cursor = _drawTextures.cursor;\n      this.atlas = atlas;\n      this.textures = textures;\n      this.lastTextureCursor = cursor;\n      this.emit(TextureManager.NEW_TEXTURE_EVENT, {\n        atlas: atlas,\n        textures: textures\n      });\n    }\n\n    // PUBLIC API:\n  }, {\n    key: \"registerImage\",\n    value: function () {\n      var _registerImage = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(source) {\n        var size, image;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.imageStates[source]) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              this.imageStates[source] = {\n                status: \"loading\"\n              };\n              _context.prev = 3;\n              size = this.options.size;\n              _context.next = 7;\n              return loadImage(source, {\n                size: size.mode === \"force\" ? size.value : undefined,\n                crossOrigin: this.options.crossOrigin || undefined\n              });\n            case 7:\n              image = _context.sent;\n              this.imageStates[source] = _objectSpread2({\n                status: \"ready\",\n                image: image\n              }, refineImage(image, this.corrector, this.options));\n              this.scheduleGenerateTexture();\n              _context.next = 15;\n              break;\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](3);\n              this.imageStates[source] = {\n                status: \"error\"\n              };\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 12]]);\n      }));\n      function registerImage(_x3) {\n        return _registerImage.apply(this, arguments);\n      }\n      return registerImage;\n    }()\n  }, {\n    key: \"getAtlas\",\n    value: function getAtlas() {\n      return this.atlas;\n    }\n  }, {\n    key: \"getTextures\",\n    value: function getTextures() {\n      return this.textures;\n    }\n  }]);\n  return TextureManager;\n}(EventEmitter);\n_defineProperty(TextureManager, \"NEW_TEXTURE_EVENT\", \"newTexture\");\n\nvar _excluded = [\"drawHover\", \"drawLabel\", \"drawingMode\", \"keepWithinCircle\", \"padding\", \"colorAttribute\", \"imageAttribute\"];\nvar _WebGLRenderingContex = WebGLRenderingContext,\n  UNSIGNED_BYTE = _WebGLRenderingContex.UNSIGNED_BYTE,\n  FLOAT = _WebGLRenderingContex.FLOAT;\nvar DEFAULT_CREATE_NODE_IMAGE_OPTIONS = _objectSpread2(_objectSpread2({}, DEFAULT_TEXTURE_MANAGER_OPTIONS), {}, {\n  drawingMode: \"background\",\n  keepWithinCircle: true,\n  drawLabel: undefined,\n  drawHover: undefined,\n  padding: 0,\n  colorAttribute: \"color\",\n  imageAttribute: \"image\"\n});\nvar UNIFORMS = [\"u_sizeRatio\", \"u_correctionRatio\", \"u_cameraAngle\", \"u_percentagePadding\", \"u_matrix\", \"u_colorizeImages\", \"u_keepWithinCircle\", \"u_atlas\"];\n\n/**\n * To share the texture between the program instances of the graph and the\n * hovered nodes (to prevent some flickering, mostly), this program must be\n * \"built\" for each sigma instance:\n */\nfunction createNodeImageProgram(options) {\n  var _NodeImageProgram;\n  // Compute effective MAX_TEXTURE_SIZE from the current WebGL context:\n  var gl = document.createElement(\"canvas\").getContext(\"webgl\");\n  var defaultMaxTextureSize = Math.min(gl.getParameter(gl.MAX_TEXTURE_SIZE), DEFAULT_TEXTURE_MANAGER_OPTIONS.maxTextureSize);\n  gl.canvas.remove();\n  var _maxTextureSize = _objectSpread2(_objectSpread2(_objectSpread2({}, DEFAULT_CREATE_NODE_IMAGE_OPTIONS), {\n      maxTextureSize: defaultMaxTextureSize\n    }), options || {}),\n    drawHover = _maxTextureSize.drawHover,\n    drawLabel = _maxTextureSize.drawLabel,\n    drawingMode = _maxTextureSize.drawingMode,\n    keepWithinCircle = _maxTextureSize.keepWithinCircle,\n    padding = _maxTextureSize.padding,\n    colorAttribute = _maxTextureSize.colorAttribute,\n    imageAttribute = _maxTextureSize.imageAttribute,\n    textureManagerOptions = _objectWithoutProperties(_maxTextureSize, _excluded);\n\n  /**\n   * This texture manager is shared between all instances of this exact class,\n   * returned by this call to createNodeProgramImage. This means that\n   * remounting the sigma instance will not reload the images and regenerate\n   * the texture.\n   */\n  var textureManager = new TextureManager(textureManagerOptions);\n  return _NodeImageProgram = /*#__PURE__*/function (_NodeProgram) {\n    _inherits(NodeImageProgram, _NodeProgram);\n    function NodeImageProgram(gl, pickingBuffer, renderer) {\n      var _this;\n      _classCallCheck(this, NodeImageProgram);\n      _this = _callSuper(this, NodeImageProgram, [gl, pickingBuffer, renderer]);\n      _defineProperty(_assertThisInitialized(_this), \"drawLabel\", drawLabel);\n      _defineProperty(_assertThisInitialized(_this), \"drawHover\", drawHover);\n      _defineProperty(_assertThisInitialized(_this), \"textureManagerCallback\", null);\n      _this.textureManagerCallback = function (_ref) {\n        var atlas = _ref.atlas,\n          textures = _ref.textures;\n        var shouldUpgradeShaders = textures.length !== _this.textures.length;\n        _this.atlas = atlas;\n        _this.textureImages = textures;\n        if (shouldUpgradeShaders) _this.upgradeShaders();\n        _this.bindTextures();\n        if (_this.latestRenderParams) _this.render(_this.latestRenderParams);\n        if (_this.renderer && _this.renderer.refresh) _this.renderer.refresh();\n      };\n      textureManager.on(TextureManager.NEW_TEXTURE_EVENT, _this.textureManagerCallback);\n      _this.atlas = textureManager.getAtlas();\n      _this.textureImages = textureManager.getTextures();\n      _this.textures = _this.textureImages.map(function () {\n        return gl.createTexture();\n      });\n      _this.bindTextures();\n      return _this;\n    }\n    _createClass(NodeImageProgram, [{\n      key: \"getDefinition\",\n      value: function getDefinition() {\n        return {\n          VERTICES: 3,\n          VERTEX_SHADER_SOURCE: VERTEX_SHADER_SOURCE$1,\n          FRAGMENT_SHADER_SOURCE: getFragmentShader({\n            texturesCount: textureManager.getTextures().length\n          }),\n          METHOD: WebGLRenderingContext.TRIANGLES,\n          UNIFORMS: UNIFORMS,\n          ATTRIBUTES: [{\n            name: \"a_position\",\n            size: 2,\n            type: FLOAT\n          }, {\n            name: \"a_size\",\n            size: 1,\n            type: FLOAT\n          }, {\n            name: \"a_color\",\n            size: 4,\n            type: UNSIGNED_BYTE,\n            normalized: true\n          }, {\n            name: \"a_id\",\n            size: 4,\n            type: UNSIGNED_BYTE,\n            normalized: true\n          }, {\n            name: \"a_texture\",\n            size: 4,\n            type: FLOAT\n          }, {\n            name: \"a_textureIndex\",\n            size: 1,\n            type: FLOAT\n          }],\n          CONSTANT_ATTRIBUTES: [{\n            name: \"a_angle\",\n            size: 1,\n            type: FLOAT\n          }],\n          CONSTANT_DATA: [[NodeImageProgram.ANGLE_1], [NodeImageProgram.ANGLE_2], [NodeImageProgram.ANGLE_3]]\n        };\n      }\n    }, {\n      key: \"upgradeShaders\",\n      value: function upgradeShaders() {\n        var def = this.getDefinition();\n        var _this$normalProgram = this.normalProgram,\n          program = _this$normalProgram.program,\n          buffer = _this$normalProgram.buffer,\n          vertexShader = _this$normalProgram.vertexShader,\n          fragmentShader = _this$normalProgram.fragmentShader,\n          gl = _this$normalProgram.gl;\n        gl.deleteProgram(program);\n        gl.deleteBuffer(buffer);\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n        this.normalProgram = this.getProgramInfo(\"normal\", gl, def.VERTEX_SHADER_SOURCE, def.FRAGMENT_SHADER_SOURCE, null);\n      }\n    }, {\n      key: \"kill\",\n      value: function kill() {\n        var _this$normalProgram2;\n        var gl = (_this$normalProgram2 = this.normalProgram) === null || _this$normalProgram2 === void 0 ? void 0 : _this$normalProgram2.gl;\n        if (gl) {\n          for (var i = 0; i < this.textures.length; i++) {\n            gl.deleteTexture(this.textures[i]);\n          }\n        }\n        if (this.textureManagerCallback) {\n          textureManager.off(TextureManager.NEW_TEXTURE_EVENT, this.textureManagerCallback);\n          this.textureManagerCallback = null;\n        }\n        _superPropGet(NodeImageProgram, \"kill\", this, 3)([]);\n      }\n    }, {\n      key: \"bindTextures\",\n      value: function bindTextures() {\n        var gl = this.normalProgram.gl;\n        for (var i = 0; i < this.textureImages.length; i++) {\n          if (i >= this.textures.length) {\n            var texture = gl.createTexture();\n            if (texture) this.textures.push(texture);\n          }\n          gl.activeTexture(gl.TEXTURE0 + i);\n          gl.bindTexture(gl.TEXTURE_2D, this.textures[i]);\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.textureImages[i]);\n          gl.generateMipmap(gl.TEXTURE_2D);\n        }\n      }\n    }, {\n      key: \"renderProgram\",\n      value: function renderProgram(params, programInfo) {\n        if (!programInfo.isPicking) {\n          // Rebind texture (since it's been just unbound by picking):\n          var _gl = programInfo.gl;\n          for (var i = 0; i < this.textureImages.length; i++) {\n            _gl.activeTexture(_gl.TEXTURE0 + i);\n            _gl.bindTexture(_gl.TEXTURE_2D, this.textures[i]);\n          }\n        }\n        _superPropGet(NodeImageProgram, \"renderProgram\", this, 3)([params, programInfo]);\n      }\n    }, {\n      key: \"processVisibleItem\",\n      value: function processVisibleItem(nodeIndex, startIndex, data) {\n        var array = this.array;\n        var color = floatColor(data[colorAttribute]);\n        var imageSource = data[imageAttribute];\n        var imagePosition = imageSource ? this.atlas[imageSource] : undefined;\n        if (typeof imageSource === \"string\" && !imagePosition) textureManager.registerImage(imageSource);\n        array[startIndex++] = data.x;\n        array[startIndex++] = data.y;\n        array[startIndex++] = data.size;\n        array[startIndex++] = color;\n        array[startIndex++] = nodeIndex;\n\n        // Reference texture:\n        if (imagePosition && typeof imagePosition.textureIndex === \"number\") {\n          var _this$textureImages$i = this.textureImages[imagePosition.textureIndex],\n            width = _this$textureImages$i.width,\n            height = _this$textureImages$i.height;\n          array[startIndex++] = imagePosition.x / width;\n          array[startIndex++] = imagePosition.y / height;\n          array[startIndex++] = imagePosition.size / width;\n          array[startIndex++] = imagePosition.size / height;\n          array[startIndex++] = imagePosition.textureIndex;\n        } else {\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n          array[startIndex++] = 0;\n        }\n      }\n    }, {\n      key: \"setUniforms\",\n      value: function setUniforms(params, _ref2) {\n        var gl = _ref2.gl,\n          uniformLocations = _ref2.uniformLocations;\n        var u_sizeRatio = uniformLocations.u_sizeRatio,\n          u_correctionRatio = uniformLocations.u_correctionRatio,\n          u_matrix = uniformLocations.u_matrix,\n          u_atlas = uniformLocations.u_atlas,\n          u_colorizeImages = uniformLocations.u_colorizeImages,\n          u_keepWithinCircle = uniformLocations.u_keepWithinCircle,\n          u_cameraAngle = uniformLocations.u_cameraAngle,\n          u_percentagePadding = uniformLocations.u_percentagePadding;\n        this.latestRenderParams = params;\n        gl.uniform1f(u_correctionRatio, params.correctionRatio);\n        gl.uniform1f(u_sizeRatio, keepWithinCircle ? params.sizeRatio : params.sizeRatio / Math.SQRT2);\n        gl.uniform1f(u_cameraAngle, params.cameraAngle);\n        gl.uniform1f(u_percentagePadding, padding);\n        gl.uniformMatrix3fv(u_matrix, false, params.matrix);\n        gl.uniform1iv(u_atlas, _toConsumableArray(new Array(this.textureImages.length)).map(function (_, i) {\n          return i;\n        }));\n        gl.uniform1i(u_colorizeImages, drawingMode === \"color\" ? 1 : 0);\n        gl.uniform1i(u_keepWithinCircle, keepWithinCircle ? 1 : 0);\n      }\n    }]);\n    return NodeImageProgram;\n  }(NodeProgram), _defineProperty(_NodeImageProgram, \"ANGLE_1\", 0), _defineProperty(_NodeImageProgram, \"ANGLE_2\", 2 * Math.PI / 3), _defineProperty(_NodeImageProgram, \"ANGLE_3\", 4 * Math.PI / 3), _defineProperty(_NodeImageProgram, \"textureManager\", textureManager), _NodeImageProgram;\n}\n\nvar NodeImageProgram = createNodeImageProgram();\nvar NodePictogramProgram = createNodeImageProgram({\n  keepWithinCircle: false,\n  size: {\n    mode: \"force\",\n    value: 256\n  },\n  drawingMode: \"color\",\n  correctCentering: true\n});\n\nexport { NodeImageProgram, NodePictogramProgram, createNodeImageProgram };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}